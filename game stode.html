<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game stode - متجر بلايستيشن الإقليمي</title>
    <link rel="stylesheet" href="game stode.css">
</head>
<body dir="rtl">
    <div class="header">
        <img class="logo-img" src="logo.jpeg" alt="شعار بودي ستور">
        <div class="links">
            <div class="dropdown">
                <a href="#">الرئيسية</a>
            </div>
            <div class="dropdown">
                <a href="#psnCardsContainer">التسوق</a>
                <div class="dropdown-content">
                    <a href="#psn-us-section">كروت أمريكا</a>
                    <a href="#psn-sa-section">كروت السعودية</a>
                    <a href="#psn-ae-section">كروت الإمارات</a>
                </div>
            </div>
            <div class="dropdown">
                <a href="#footer">اتصل بنا</a>
            </div>
            <img class="header-cart-icon" id="openCartBtn" src="shopping icon.png" alt="سلة المشتريات">
            </div>
    </div>

    <div class="trending-main" id="allPsnMain" style="padding-top: 20px;">
        <div class="trending-title">
            <div>
                <span>الكتالوج</span>
                <h1>كل كروت البلايستيشن (الأسعار بال ج.م)</h1>
            </div>
        </div>

        <div class="trending-games" id="psnCardsContainer" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 30px;">

            <h2 id="psn-us-section" style="width: 100%; text-align: center; color: #008cff; margin-top: 40px; border-bottom: 2px solid #eee; padding-bottom: 10px;">كروت بلايستيشن - ريجون أمريكا (دولار أمريكي)</h2>

            <div class="assasains-creed game-card" data-id="psn-10-usd-us" data-title="كارت بلايستيشن $10 (أمريكا)" data-price="480" data-image="psn-10-usa.webp" data-description="إشتري كارت $10 بلايستيشن لـ ريجون أمريكا. سعره 480 ج.م.">
                <div class="assasains-img">
                    <img src="psn-10-usa.webp" alt="كارت بلايستيشن $10 أمريكا">
                </div>
                <div class="assasains-lower">
                    <div class="assasains-title">
                        <h5>كارت بلايستيشن $10 (أمريكا) - 480 ج.م</h5>
                    </div>
                    <div class="shopping-icon add-to-cart-btn">
                        <img src="shopping icon.png" alt="أيقونة السلة">
                    </div>
                </div>
            </div>

            <div class="assasains-creed game-card" data-id="psn-25-usd-us" data-title="كارت بلايستيشن $25 (أمريكا)" data-price="1195" data-image="psn-25-usa.webp" data-description="إشتري كارت $25 بلايستيشن لـ ريجون أمريكا. سعره 1195 ج.م.">
                <div class="assasains-img">
                    <img src="psn-25-usa.webp" alt="كارت بلايستيشن $25 أمريكا">
                </div>
                <div class="assasains-lower">
                    <div class="assasains-title">
                        <h5>كارت بلايستيشن $25 (أمريكا) - 1195 ج.م</h5>
                    </div>
                    <div class="shopping-icon add-to-cart-btn">
                        <img src="shopping icon.png" alt="أيقونة السلة">
                    </div>
                </div>
            </div>

            <div class="assasains-creed game-card" data-id="psn-50-usd-us" data-title="كارت بلايستيشن $50 (أمريكا)" data-price="2385" data-image="psn-50-usa.webp" data-description="إشتري كارت $50 بلايستيشن لـ ريجون أمريكا. سعره 2385 ج.م.">
                <div class="assasains-img">
                    <img src="psn-50-usa.webp" alt="كارت بلايستيشن $50 أمريكا">
                </div>
                <div class="assasains-lower">
                    <div class="assasains-title">
                        <h5>كارت بلايستيشن $50 (أمريكا) - 2385 ج.م</h5>
                    </div>
                    <div class="shopping-icon add-to-cart-btn">
                        <img src="shopping icon.png" alt="أيقونة السلة">
                    </div>
                </div>
            </div>

            <div class="assasains-creed game-card" data-id="psn-75-usd-us" data-title="كارت بلايستيشن $75 (أمريكا)" data-price="3575" data-image="psn-75-usa.webp" data-description="إشتري كارت $75 بلايستيشن لـ ريجون أمريكا. سعره 3575 ج.م.">
                <div class="assasains-img">
                    <img src="psn-75-usa.webp" alt="كارت بلايستيشن $75 أمريكا">
                </div>
                <div class="assasains-lower">
                    <div class="assasains-title">
                        <h5>كارت بلايستيشن $75 (أمريكا) - 3575 ج.م</h5>
                    </div>
                    <div class="shopping-icon add-to-cart-btn">
                        <img src="shopping icon.png" alt="أيقونة السلة">
                    </div>
                </div>
            </div>

            <div class="assasains-creed game-card" data-id="psn-100-usd-us" data-title="كارت بلايستيشن $100 (أمريكا)" data-price="4770" data-image="psn-100-usa.webp" data-description="إشتري كارت $100 بلايستيشن لـ ريجون أمريكا. سعره 4770 ج.م.">
                <div class="assasains-img">
                    <img src="psn-100-usa.webp" alt="كارت بلايستيشن $100 أمريكا">
                </div>
                <div class="assasains-lower">
                    <div class="assasains-title">
                        <h5>كارت بلايستيشن $100 (أمريكا) - 4770 ج.م</h5>
                    </div>
                    <div class="shopping-icon add-to-cart-btn">
                        <img src="shopping icon.png" alt="أيقونة السلة">
                    </div>
                </div>
            </div>
            
            <h2 id="psn-sa-section" style="width: 100%; text-align: center; color: #008cff; margin-top: 40px; border-bottom: 2px solid #eee; padding-bottom: 10px;">كروت بلايستيشن - ريجون السعودية </h2>
            <div class="assasains-creed game-card" data-id="psn-37-5-sar-sa" data-title="كارت بلايستيشن 10$ (السعودية)" data-price="485" data-image="psn-10-ksa.jpg.webp" data-description="إشتري كارت سعودي بلايستيشن لـ ريجون السعودية (قيمة $10 دولار أمريكي). سعره 485 ج.م.">
                <div class="assasains-img">
                    <img src="psn-10-ksa.jpg.webp" alt="كارت بلايستيشن 37.5 ر.س السعودية">
                </div>
                <div class="assasains-lower">
                    <div class="assasains-title">
                        <h5>كارت بلايستيشن 10$ (السعودية) - 485 ج.م </h5>
                    </div>
                    <div class="shopping-icon add-to-cart-btn">
                        <img src="shopping icon.png" alt="أيقونة السلة">
                    </div>
                </div>
            </div>
            
            <div class="assasains-creed game-card" data-id="psn-93-75-sar-sa" data-title="كارت بلايستيشن 10$ (السعودية)" data-price="965" data-image="psn-10-ksa.webp" data-description="إشتري كارت سعودي بلايستيشن لـ ريجون السعودية (قيمة $20 دولار أمريكي). سعره 965 ج.م.">
                <div class="assasains-img">
                    <img src="psn-10-ksa.webp" alt="كارت بلايستيشن 93.75 ر.س السعودية">
                </div>
                <div class="assasains-lower">
                    <div class="assasains-title">
                        <h5>كارت بلايستيشن 20$ (السعودية) - 965 ج.م</h5>
                    </div>
                    <div class="shopping-icon add-to-cart-btn">
                        <img src="shopping icon.png" alt="أيقونة السلة">
                    </div>
                </div>
            </div>

            <div class="assasains-creed game-card" data-id="psn-187-5-sar-sa" data-title="كارت بلايستيشن 40$ (السعودية)" data-price="1925" data-image="psn-40-ksa.jpg" data-description="إشتري كارت سعودي بلايستيشن لـ ريجون السعودية (قيمة $40 دولار أمريكي). سعره 1925 ج.م.">
                <div class="assasains-img">
                    <img src="psn-40-ksa.jpg" alt="كارت بلايستيشن 187.5 ر.س السعودية">
                </div>
                <div class="assasains-lower">
                    <div class="assasains-title">
                        <h5>كارت بلايستيشن 40$ (السعودية) - 1925 ج.م</h5>
                    </div>
                    <div class="shopping-icon add-to-cart-btn">
                        <img src="shopping icon.png" alt="أيقونة السلة">
                    </div>
                </div>
            </div>

            <div class="assasains-creed game-card" data-id="psn-281-25-sar-sa" data-title="كارت بلايستيشن 50$ (السعودية)" data-price="2400" data-image="psn-50-ksa.jpg.webp" data-description="إشتري كارت سعودي بلايستيشن لـ ريجون السعودية (قيمة  $50 دولار أمريكي). سعره 2400 ج.م.">
                <div class="assasains-img">
                    <img src="psn-50-ksa.jpg.webp" alt="كارت بلايستيشن 281.25 ر.س السعودية">
                </div>
                <div class="assasains-lower">
                    <div class="assasains-title">
                        <h5>كارت بلايستيشن 50$ (السعودية) - 2400 ج.م</h5>
                    </div>
                    <div class="shopping-icon add-to-cart-btn">
                        <img src="shopping icon.png" alt="أيقونة السلة">
                    </div>
                </div>
            </div>

            <div class="assasains-creed game-card" data-id="psn-375-sar-sa" data-title="كارت بلايستيشن 100$ (السعودية)" data-price="4790" data-image="psn-100-ksa.jpeg" data-description="إشتري كارت سعودي بلايستيشن لـ ريجون السعودية (قيمة $100 دولار أمريكي). سعره 4790 ج.م.">
                <div class="assasains-img">
                    <img src="psn-100-ksa.jpeg" alt="كارت بلايستيشن 375 ر.س السعودية">
                </div>
                <div class="assasains-lower">
                    <div class="assasains-title">
                        <h5>كارت بلايستيشن 100$ (السعودية) - 4790 ج.م</h5>
                    </div>
                    <div class="shopping-icon add-to-cart-btn">
                        <img src="shopping icon.png" alt="أيقونة السلة">
                    </div>
                </div>
            </div>

            <h2 id="psn-ae-section" style="width: 100%; text-align: center; color: #008cff; margin-top: 40px; border-bottom: 2px solid #eee; padding-bottom: 10px;">كروت بلايستيشن - ريجون الإمارات </h2>
            <div class="assasains-creed game-card" data-id="psn-36-7-aed-ae" data-title="كارت بلايستيشن 10$ (الإمارات)" data-price="485" data-image="psn-10-uae.webp" data-description="إشتري كارت بلايستيشن لـ ريجون الإمارات (قيمة $10 دولار أمريكي). سعره 485 ج.م.">
                <div class="assasains-img">
                    <img src="psn-10-uae.webp" alt="كارت بلايستيشن 36.7 د.إ الإمارات">
                </div>
                <div class="assasains-lower">
                    <div class="assasains-title">
                        <h5>كارت بلايستيشن 10$ (الإمارات) - 485 ج.م</h5>
                    </div>
                    <div class="shopping-icon add-to-cart-btn">
                        <img src="shopping icon.png" alt="أيقونة السلة">
                    </div>
                </div>
            </div>
            
            <div class="assasains-creed game-card" data-id="psn-91-75-aed-ae" data-title="كارت بلايستيشن 20$ (الإمارات)" data-price="965" data-image="psn-20-uae.png" data-description="إشتري كارت إماراتي بلايستيشن لـ ريجون الإمارات (قيمة $20 دولار أمريكي). سعره 965 ج.م.">
                <div class="assasains-img">
                    <img src="psn-20-uae.png" alt="كارت بلايستيشن 91.75 د.إ الإمارات">
                </div>
                <div class="assasains-lower">
                    <div class="assasains-title">
                        <h5>كارت بلايستيشن 20$ (الإمارات) - 965 ج.م</h5>
                    </div>
                    <div class="shopping-icon add-to-cart-btn">
                        <img src="shopping icon.png" alt="أيقونة السلة">
                    </div>
                </div>
            </div>

            <div class="assasains-creed game-card" data-id="psn-183-5-aed-ae" data-title="كارت بلايستيشن 40$ (الإمارات)" data-price="1925" data-image="psn-40-uae.png" data-description="إشتري كارت إماراتي بلايستيشن لـ ريجون الإمارات (قيمة $40 دولار أمريكي). سعره 1925 ج.م.">
                <div class="assasains-img">
                    <img src="psn-40-uae.png" alt="كارت بلايستيشن 183.5 د.إ الإمارات">
                </div>
                <div class="assasains-lower">
                    <div class="assasains-title">
                        <h5>كارت بلايستيشن 40$ (الإمارات) - 1925 ج.م</h5>
                    </div>
                    <div class="shopping-icon add-to-cart-btn">
                        <img src="shopping icon.png" alt="أيقونة السلة">
                    </div>
                </div>
            </div>

            <div class="assasains-creed game-card" data-id="psn-275-25-aed-ae" data-title="كارت بلايستيشن 50$ (الإمارات)" data-price="2400" data-image="psn-10-usa.webp" data-description="إشتري كارت إماراتي بلايستيشن لـ ريجون الإمارات (قيمة $50 دولار أمريكي). سعره 2400 ج.م.">
                <div class="assasains-img">
                    <img src="psn-50-uae.png" alt="كارت بلايستيشن 275.25 د.إ الإمارات">
                </div>
                <div class="assasains-lower">
                    <div class="assasains-title">
                        <h5>كارت بلايستيشن 50$ (الإمارات) - 2400 ج.م</h5>
                    </div>
                    <div class="shopping-icon add-to-cart-btn">
                        <img src="shopping icon.png" alt="أيقونة السلة">
                    </div>
                </div>
            </div>

            <div class="assasains-creed game-card" data-id="psn-367-aed-ae" data-title="كارت بلايستيشن 100$ (الإمارات)" data-price="4790" data-image="psn-100-uae.png" data-description="إشتري كارت بلايستيشن لـ ريجون الإمارات (قيمة $100 دولار أمريكي). سعره 4790 ج.م.">
                <div class="assasains-img">
                    <img src="psn-100-uae.png" alt="كارت بلايستيشن 367 د.إ الإمارات">
                </div>
                <div class="assasains-lower">
                    <div class="assasains-title">
                        <h5>كارت بلايستيشن 100$ (الإمارات) - 4790 ج.م</h5>
                    </div>
                    <div class="shopping-icon add-to-cart-btn">
                        <img src="shopping icon.png" alt="أيقونة السلة">
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <div class="footer" id="footer">
        <div class="footer-info">
            تفاصيل التواصل وطرق الدفع
        </div>
        <div class="footer-cards">
            <div class="flip-card">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <h3>طرق الدفع المتاحة</h3>
                        <p>يمكنك الدفع عبر:</p>
                        <p>• **Instapay**</p>
                        <p>• **Telda**</p>
                        <p style="color: red; margin-top: 15px;">إقلب البطاقة لمعرفة التفاصيل!</p>
                    </div>
                    <div class="flip-card-back">
                        <h1>طرق الدفع</h1>
                        <p>نقبل الدفعات عن طريق **Instapay** و **Telda** فقط حاليًا.</p>
                        <p>سيتم توفير تفاصيل الدفع بعد التواصل.</p>
                        <a href="https://www.facebook.com/profile.php?id=61586259234407" target="_blank" class="fotter-button facebook-btn">تواصل لطلب الشراء</a>
                    </div>
                </div>
            </div>

            <div class="flip-card">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <h3>خطوات الشراء</h3>
                        <p>العملية سهلة وسريعة:</p>
                        <p>1. إختر الكروت وأضفها للسلة.</p>
                        <p>2. إقلب البطاقة لمعرفة باقي الخطوات.</p>
                        <p style="color: red; margin-top: 15px;">إقلب البطاقة لإكمال الخطوات!</p>
                    </div>
                    <div class="flip-card-back">
                        <h1>خطوات الشراء</h1>
                        <ol style="padding-right: 20px; text-align: right;">
                            <li>إختر الكروت وإضغط **إضافة للسلة**.</li>
                            <li>افتح السلة و**إلتقط صورة** للسلة.</li>
                            <li>**تواصل معنا** على فيسبوك وأرسل الصورة.</li>
                            <li>قم بالدفع عن طريق Instapay/Telda.</li>
                            <li>إستلم الكود فور تأكيد الدفع!</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="flip-card">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <h3 style="margin-top: 20px;">تواصل معنا فورًا</h3>
                        <p style="font-size: 0.9em;">أسرع طريقة لإتمام الطلب هي عبر الفيسبوك.</p>
                        <a href="https://www.facebook.com/BoodyStore" target="_blank" class="fotter-button facebook-btn" style="width: 80%;">
                            صفحتنا على فيسبوك
                        </a>
                    </div>
                    <div class="flip-card-back">
                        <h1>تواصل معنا</h1>
                        <h2>Game Stode</h2>
                        <p>لأي استفسارات، أو لإنهاء طلب الشراء!</p>
                        <a href="https://www.facebook.com/profile.php?id=61586259234407" target="_blank" class="fotter-button facebook-btn">إضغط للتواصل الآن</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ... (Existing script content) ...

            // 6. Non-critical buttons (Updated to handle the new contact button if necessary, 
            // but the Facebook button is now an <a> tag for direct link)
            // The old contactBtns loop is no longer strictly necessary if all are <a> tags, 
            // but keeping it for existing buttons just in case.
            const contactBtns = document.querySelectorAll('.contact-btn, .facebook-btn'); 
            contactBtns.forEach(button => {
                if (button.tagName === 'BUTTON') { // Only for old buttons that might still exist
                    button.addEventListener('click', () => {
                        showMessage("خاصية فورم التواصل هتيجي قريب!"); 
                    });
                }
            });
            
            // ... (Rest of the script) ...
        });
    </script>
</body>
</html>
    <div id="shoppingCartModal" class="shopping-cart-modal-overlay">
        <div class="cart-content">
            <button class="modal-close-btn" id="closeCartBtn">&times;</button>
            <h2>سلة مشترياتك</h2>
            <div class="cart-items" id="cartItemsContainer">
                <p>السلة فاضية.</p>
            </div>
            <div class="cart-total">
                الإجمالي: ج.م <span id="cartTotal">٠.٠٠</span>
            </div>
            <div class="cart-actions">
                <p style="color: #008cff; font-weight: bold; margin-bottom: 10px;">
                    عشان تكمل طلبك، من فضلك ابعت صورة سكرين شوت للسلة على صفحتنا على 
                    <a href="https://www.facebook.com/BoodyStore" target="_blank" style="color: #3b5998; text-decoration: underline;">فيسبوك</a>!
                </p>
                <button class="clear-cart-btn" id="clearCartBtn">فضي السلة</button>
            </div>
        </div>
    </div>

    <div id="messageBox" class="message-box"></div>

    <div id="newGameDescriptionModal" class="modal-overlay new-game-description-modal-overlay">
        <div class="modal-content new-game-description-content">
            <button class="modal-close-btn" id="closeNewGameDescriptionBtn">&times;</button>
            <div class="new-game-description-details">
                <div class="new-game-description-image">
                   <img id="newGameDescriptionImage" src="" alt="صورة الكارت">
                </div>
                <div class="new-game-description-info">
                    <h2 id="newGameDescriptionTitle">اسم الكارت</h2>
                    <p id="newGameDescriptionText">وصف مختصر للكارت هيكون هنا.</p>
                    <span class="new-game-description-price">السعر: ج.م <span id="newGameDescriptionPrice">٠.٠٠</span></span>
                    <div class="new-game-description-quantity-controls">
                        <button id="decreaseNewGameQuantityBtn" class="new-quantity-btn">-</button>
                        <span id="newGameQuantityDisplay" class="new-game-quantity">١</span>
                        <button id="increaseNewGameQuantityBtn" class="new-quantity-btn">+</button>
                    </div>
                    <button class="btn new-add-to-cart-from-description-btn" data-product-id="">ضيف للسلة</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Variable Declarations ---
            const shoppingCartModal = document.getElementById('shoppingCartModal');
            const openCartBtn = document.getElementById('openCartBtn');
            const closeCartBtn = document.getElementById('closeCartBtn');
            const cartItemsContainer = document.getElementById('cartItemsContainer');
            const cartTotalSpan = document.getElementById('cartTotal');
            const clearCartBtn = document.getElementById('clearCartBtn');
            const messageBox = document.getElementById('messageBox');
            const contactBtns = document.querySelectorAll('.contact-btn');
            const gameCards = document.querySelectorAll('.game-card');
            
            // Game Description Modal Variables
            const newGameDescriptionModal = document.getElementById('newGameDescriptionModal');
            const closeNewGameDescriptionBtn = document.getElementById('closeNewGameDescriptionBtn');
            const newGameDescriptionImage = document.getElementById('newGameDescriptionImage');
            const newGameDescriptionTitle = document.getElementById('newGameDescriptionTitle');
            const newGameDescriptionText = document.getElementById('newGameDescriptionText');
            const newGameDescriptionPrice = document.getElementById('newGameDescriptionPrice');
            const decreaseNewGameQuantityBtn = document.getElementById('decreaseNewGameQuantityBtn');
            const newGameQuantityDisplay = document.getElementById('newGameQuantityDisplay');
            const increaseNewGameQuantityBtn = document.getElementById('increaseNewGameQuantityBtn');
            const newAddToCartFromDescriptionBtn = document.querySelector('.new-add-to-cart-from-description-btn');
            let newCurrentGameQuantity = 1;

            let cart = []; // Array to store products in the cart
            
            // --- Utility Function: Display Message ---
            function showMessage(message, duration = 3000) {
                messageBox.textContent = message;
                messageBox.classList.add('show');
                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, duration);
            }

            // --- Shopping Cart Functions ---
            function renderCart() {
                cartItemsContainer.innerHTML = ''; 
                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = '<p>السلة فاضية.</p>'; // Arabic
                } else {
                    cart.forEach(item => {
                        const cartItemDiv = document.createElement('div');
                        cartItemDiv.classList.add('cart-item');
                        cartItemDiv.innerHTML = `
                            <div class="item-info">
                                <span>${item.title}</span>
                                <span>${item.price.toFixed(2)} ج.م</span> 
                            </div>
                            <div class="item-quantity-controls">
                                <button data-product-id="${item.id}" data-action="decrease">-</button>
                                <span class="item-quantity">${item.quantity}</span>
                                <button data-product-id="${item.id}" data-action="increase">+</button>
                                <button data-product-id="${item.id}" data-action="remove" class="btn delete-btn" style="background-color: #dc3545; margin-left: 10px; width: 30px; height: 30px; border-radius: 5px; box-shadow: none;">&#10006;</button> </div>
                        `;
                        cartItemsContainer.appendChild(cartItemDiv); 
                    });
                }
                updateCartTotal(); 
            }

            function updateCartTotal() {
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                cartTotalSpan.textContent = total.toFixed(2); 
            }

            function addToCart(id, title, price, quantityToAdd) {
                const existingItem = cart.find(item => item.id === id);
                if (existingItem) {
                    existingItem.quantity += quantityToAdd; 
                } else {
                    cart.push({ id: id, title: title, price: price, quantity: quantityToAdd });
                }
                showMessage(`${title} x${quantityToAdd} ضاف للسلة!`); 
                renderCart(); 
            }

            function updateCartItemQuantity(productId, action) {
                const itemIndex = cart.findIndex(item => item.id === productId);

                if (itemIndex > -1) { 
                    if (action === 'increase') {
                        cart[itemIndex].quantity++; 
                    } else if (action === 'decrease') {
                        cart[itemIndex].quantity--; 
                        if (cart[itemIndex].quantity <= 0) {
                            cart.splice(itemIndex, 1); 
                        }
                    } else if (action === 'remove') {
                        cart.splice(itemIndex, 1); 
                    }
                    renderCart(); 
                }
            }

            function clearCart() {
                cart = []; 
                renderCart(); 
                showMessage('السلة فضيت!'); 
            }

            // --- Game Description Modal Functions ---
            function showNewGameDescription(game) {
                newGameDescriptionImage.src = game.dataset.image || 'placeholder.webp';
                newGameDescriptionTitle.textContent = game.dataset.title;
                newGameDescriptionText.textContent = game.dataset.description;
                newGameDescriptionPrice.textContent = parseFloat(game.dataset.price).toFixed(2);
                
                // Reset quantity control and set data attributes for the Add to Cart button
                newCurrentGameQuantity = 1;
                newGameQuantityDisplay.textContent = newCurrentGameQuantity;
                newAddToCartFromDescriptionBtn.dataset.productId = game.dataset.id;
                newAddToCartFromDescriptionBtn.dataset.productTitle = game.dataset.title;
                newAddToCartFromDescriptionBtn.dataset.productPrice = game.dataset.price;

                newGameDescriptionModal.style.display = 'flex';
            }

            function hideNewGameDescription() {
                newGameDescriptionModal.style.display = 'none';
                newCurrentGameQuantity = 1; // Reset quantity on close
            }

            // --- Event Listeners (The FIX) ---

            // 1. Open and Close Cart
            openCartBtn.addEventListener('click', () => {
                shoppingCartModal.style.display = 'flex';
                renderCart();
            });

            closeCartBtn.addEventListener('click', () => {
                shoppingCartModal.style.display = 'none';
            });

            // Close cart by clicking outside
            shoppingCartModal.addEventListener('click', (event) => {
                if (event.target === shoppingCartModal) {
                    shoppingCartModal.style.display = 'none';
                }
            });

            // 2. Clear Cart Button
            clearCartBtn.addEventListener('click', clearCart);

            // 3. Cart Item Quantity/Remove (Event Delegation for dynamic elements)
            cartItemsContainer.addEventListener('click', (event) => {
                const target = event.target;
                if (target.tagName === 'BUTTON' && target.dataset.productId) {
                    const productId = target.dataset.productId;
                    const action = target.dataset.action;
                    updateCartItemQuantity(productId, action);
                }
            });

            // 4. Product Card Clicks (to open Description Modal or Direct Add to Cart)
            gameCards.forEach(card => {
                card.addEventListener('click', (event) => {
                    const target = event.target;
                    const cardData = card.dataset;

                    // Check if the click was specifically on the 'Add to Cart' icon
                    if (target.closest('.add-to-cart-btn')) {
                        // Prevent the card from opening the description modal
                        event.stopPropagation(); 
                        // Directly add 1 quantity to the cart
                        const id = cardData.id;
                        const title = cardData.title;
                        const price = parseFloat(cardData.price);
                        addToCart(id, title, price, 1);
                    } else {
                        // Click on any other part of the card opens the description modal
                        showNewGameDescription(card);
                    }
                });
            });

            // 5. Game Description Modal Controls
            // Close Game Description Modal
            closeNewGameDescriptionBtn.addEventListener('click', hideNewGameDescription);
            newGameDescriptionModal.addEventListener('click', (event) => {
                if (event.target === newGameDescriptionModal) { 
                    hideNewGameDescription();
                }
            });

            // Quantity controls inside description modal
            decreaseNewGameQuantityBtn.addEventListener('click', () => {
                if (newCurrentGameQuantity > 1) { 
                    newCurrentGameQuantity--;
                    newGameQuantityDisplay.textContent = newCurrentGameQuantity; 
                }
            });

            increaseNewGameQuantityBtn.addEventListener('click', () => {
                newCurrentGameQuantity++;
                newGameQuantityDisplay.textContent = newCurrentGameQuantity; 
            });

            // Add to Cart button inside Game Description Modal
            newAddToCartFromDescriptionBtn.addEventListener('click', (event) => {
                const gameId = event.target.dataset.productId;
                const gameTitle = event.target.dataset.productTitle;
                const gamePrice = parseFloat(event.target.dataset.productPrice);
                
                if (gameId && gameTitle && !isNaN(gamePrice)) {
                    addToCart(gameId, gameTitle, gamePrice, newCurrentGameQuantity);
                    hideNewGameDescription(); 
                    shoppingCartModal.style.display = 'flex'; 
                } else {
                    showMessage("فيه مشكلة في بيانات الكارت!"); 
                }
            });

            // 6. Non-critical buttons
            contactBtns.forEach(button => {
                button.addEventListener('click', () => {
                    showMessage("خاصية فورم التواصل هتيجي قريب!"); 
                });
            });
        });
    </script>
</body>
</html>